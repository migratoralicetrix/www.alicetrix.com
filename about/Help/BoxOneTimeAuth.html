
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <link href="../lib/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" />
    <title>Onetime Configuration for Box</title>
</head>
<body>
    <h1>Configuring Onetime Box Service Accounts</h1>
    <p>Note: Box admin privilege required for all these operations.</p>
    <p>Box allows for both JWT and OAuth based authentication.</p>
    <p>Below help provides steps for JWT Authentication Setup. Steps for creating OAuth are same except in Step 2 Standard OAuth 2.0 App Authentication option is selected, and in Step 6 instead of JSON file Client ID and Client Secret are copied for pasting in <a href="/Migrator/AdminConfig" target="_parent">Admin</a> page for Box option. Additionally for OAuth redirect URL is entered as  Website address:port/Migrator/index</p>
    <ol>
        <li><strong> Create a new application </strong></li>
    </ol>
    <p>First, you will need to log into the <u><a href="https://app.box.com/developers/services" target="_blank" rel="noopener">Box Developer Console</a></u> and create a new application.</p>
    <p>Use your Box admin account to log in to Developer Console</p>
    <p>Once you have logged into the Box Developer Console, click "Create New App."</p>
    <p>Give app any name you can remember.</p>
    <ol start="2">
        <li><strong> Select Custom App and Server Authentication </strong></li>
    </ol>
    <img src="images/BoxOnetImeAuthImage1.jpg" width="600" />

    <p>In the app creation wizard, select "Custom App" as your use case.</p>
    <p><em>Create a custom app in the Box Developer Console.</em></p>
    <p>Next, select OAuth 2.0 with JWT (Server Authentication) as your application's authentication method.</p>
    <img src="images/BoxOnetimeAuthImage6.jpg" width="600" />
    <p><em>Select OAuth 2.0 with JWT (Server Authentication) in the Box Developer Console.</em></p>
    <p>Selecting OAuth 2.0 with JWT (Server Authentication) will allow your app to authenticate directly to the Box servers with an RSA Keypair on behalf of a Service Account.</p>
    <ol start="3">
        <li><strong> Select Application Access level </strong></li>
    </ol>
    <p>Select <strong>Enterprise</strong></p>
    <p><strong>Enterprise</strong> access will allow your app to request access to its own Service Account and any users and content, as well as other users and content within an enterprise. This access level is required.</p>

    <img src="images/BoxOnetimeAuthImage3 .jpg" width="600" />
    <p><em>Select your application's Application Access level in the Box Developer Console.</em></p>
    <ol start="4">
        <li><strong> Select Application Scopes for your application </strong></li>
    </ol>
    <p>Check Read and write all files and folders stored in Box, Manage Users, Manage Groups.</p>
    <p><em>Select your Application Scopes in the Box Developer Console.</em></p>
    <img src="images/BoxOnetimeAuthImage2.jpg" width="700" />
    <ol start="5">
        <li><strong> Select Advanced Features </strong></li>
    </ol>
    <p>Switch on both options below:</p>
    <ul>
        <li><strong><u><a href="https://developer.box.com/reference#as-user-1" target="_blank" rel="noopener">As-User</a></u></strong><strong> Calls</strong> allow your application to perform server-side &ldquo;As-User&rdquo; calls, which allow your Service Account to make calls on behalf of individual Managed Users or App Users.</li>
        <li><strong>Generate Access Tokens</strong> allows your application to generate OAuth 2.0 access tokens for individual user accounts, instead of going through the normal OAuth 2.0 flow.</li>
    </ul>
    <ol start="6">
        <li><strong> Generate a Public/Private Keypair </strong></li>
    </ol>
    <p>In the Box Developer Console, click "Generate a Public/Private Keypair." This will generate an RSA key pair that you can use to sign and authenticate the JWT request. Your public key will automatically be added to Box. Box does not store your private key, <strong>so make sure you save the downloaded file</strong> <strong>(This is a required step, Box will generate a JSON file that you need to upload into Admin Page in next steps).</strong> Note: This step may require a two step authentication process. If it requires two -step authentication, click on your profile icon on top right corner and go to Account Settings. Check two-step verification checkbox, make sure you have a valid phone number on which SMS can be sent. It will be used for generating Key Value pair. &nbsp;&nbsp;</p>
    <ol start="7">
        <img src="images/BoxOnetimeAuthImage4.jpg" width="600" />
        <li><strong> Grant Access to Your Application in Enterprise Admin Console </strong></li>
    </ol>
    <p>Authorization for your new application must be granted in the Enterprise Admin console, follow the instructions below.</p>
    <img src="images/BoxOnetimeAuthImage5.jpg" width="600" />
    <ol>
        <li>Log out from Developer console and Log in to <u><a href="https://cloud.app.box.com/" target="_blank" rel="noopener">Box</a></u> and select <strong>Admin Console</strong> at the top of the screen.</li>
        <li>Go to the <strong>Enterprise Settings</strong> and click on <strong>Apps</strong>.</li>
        <li>Within the <strong>Custom Applications</strong> section, choose <strong>Authorize New App</strong>.</li>
        <li>Enter the Client ID for the app (you will find it in JSON file you generated in Step 6). This will display the requested <em>Applications Scopes<strong> and </strong>User Access Level*</em> that determines which users the app has control over. Once <strong>Authorized</strong>, the app will be enabled within your Developer enterprise.</li>
    </ol>
    <ol start="8">
        <li><b>Upload Json File </b>by logging into Alicetrix Cloud File Migrator Website and go to <a href="/Migrator/AdminConfig" target="_parent">Admin</a> settings. Select Source for upload as Box and upload JSON file here. Once uploaded, your file is saved in a local database in your Azure Website Service Directory. Ensure only admins have access to Azure Web App Directory in Servers.</li>
    </ol>
    <p>
        <span class="badge badge-danger">Security Considerations</span>
        JSON files are stored in your local app server database. Hence while it is difficult to retrieve,  Administrator/RDP Users of your Migrator application's Virtual Machine environment will have access to this database (as database access policies are not set at machine levels). Hence, ensure admins who have access to app server VM environment, also have access to OneDrive/SP contents.
        In future, if you want to remove this file, you can  upload a blank file in local database, using above steps.
    </p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
</body> 
</html>

